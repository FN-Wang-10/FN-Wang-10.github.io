"use strict";(self.webpackChunkfn_wang_10_github_io=self.webpackChunkfn_wang_10_github_io||[]).push([[32092],{25045:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var t=r(85893),s=r(11151);const a={},c=void 0,l={id:"React/immutable\u4e0d\u53ef\u6539\u53d8\u6570\u636e",title:"immutable\u4e0d\u53ef\u6539\u53d8\u6570\u636e",description:"\u4e00\u3001\u662f\u4ec0\u4e48",source:"@site/docs/React/immutable\u4e0d\u53ef\u6539\u53d8\u6570\u636e.md",sourceDirName:"React",slug:"/React/immutable\u4e0d\u53ef\u6539\u53d8\u6570\u636e",permalink:"/docs/React/immutable\u4e0d\u53ef\u6539\u53d8\u6570\u636e",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"reactSidebar",previous:{title:"hooks\u5e38\u7528",permalink:"/docs/React/hooks\u5e38\u7528"},next:{title:"jsx\u8f6c\u6362\u6210\u771f\u5b9edom\u7684\u8fc7\u7a0b",permalink:"/docs/React/jsx\u8f6c\u6362\u6210\u771f\u5b9edom\u7684\u8fc7\u7a0b"}},i={},d=[{value:"\u4e00\u3001\u662f\u4ec0\u4e48",id:"\u4e00\u662f\u4ec0\u4e48",level:2},{value:"\u4e8c\u3001\u5982\u4f55\u4f7f\u7528",id:"\u4e8c\u5982\u4f55\u4f7f\u7528",level:2},{value:"\u4e09\u3001\u5728 React \u4e2d\u5e94\u7528",id:"\u4e09\u5728-react-\u4e2d\u5e94\u7528",level:2},{value:"\u53c2\u8003\u6587\u732e",id:"\u53c2\u8003\u6587\u732e",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"\u4e00\u662f\u4ec0\u4e48",children:"\u4e00\u3001\u662f\u4ec0\u4e48"}),"\n",(0,t.jsx)(n.p,{children:"Immutable\uff0c\u4e0d\u53ef\u6539\u53d8\u7684\uff0c\u5728\u8ba1\u7b97\u673a\u4e2d\uff0c\u5373\u6307\u4e00\u65e6\u521b\u5efa\uff0c\u5c31\u4e0d\u80fd\u518d\u88ab\u66f4\u6539\u7684\u6570\u636e"}),"\n",(0,t.jsxs)(n.p,{children:["\u5bf9 ",(0,t.jsx)(n.code,{children:"Immutable "}),"\u5bf9\u8c61\u7684\u4efb\u4f55\u4fee\u6539\u6216\u6dfb\u52a0\u5220\u9664\u64cd\u4f5c\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 ",(0,t.jsx)(n.code,{children:"Immutable "}),"\u5bf9\u8c61"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Immutable"})," \u5b9e\u73b0\u7684\u539f\u7406\u662f ",(0,t.jsx)(n.code,{children:"Persistent Data Structure"}),"\uff08\u6301\u4e45\u5316\u6570\u636e\u7ed3\u6784\uff09:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7528\u4e00\u79cd\u6570\u636e\u7ed3\u6784\u6765\u4fdd\u5b58\u6570\u636e"}),"\n",(0,t.jsx)(n.li,{children:"\u5f53\u6570\u636e\u88ab\u4fee\u6539\u65f6\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f46\u662f\u65b0\u7684\u5bf9\u8c61\u4f1a\u5c3d\u53ef\u80fd\u7684\u5229\u7528\u4e4b\u524d\u7684\u6570\u636e\u7ed3\u6784\u800c\u4e0d\u4f1a\u5bf9\u5185\u5b58\u9020\u6210\u6d6a\u8d39"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u4e5f\u5c31\u662f\u4f7f\u7528\u65e7\u6570\u636e\u521b\u5efa\u65b0\u6570\u636e\u65f6\uff0c\u8981\u4fdd\u8bc1\u65e7\u6570\u636e\u540c\u65f6\u53ef\u7528\u4e14\u4e0d\u53d8\uff0c\u540c\u65f6\u4e3a\u4e86\u907f\u514d ",(0,t.jsx)(n.code,{children:"deepCopy "}),"\u628a\u6240\u6709\u8282\u70b9\u90fd\u590d\u5236\u4e00\u904d\u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\uff0c",(0,t.jsx)(n.code,{children:"Immutable"})," \u4f7f\u7528\u4e86 ",(0,t.jsx)(n.code,{children:"Structural Sharing"}),"\uff08\u7ed3\u6784\u5171\u4eab\uff09"]}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u679c\u5bf9\u8c61\u6811\u4e2d\u4e00\u4e2a\u8282\u70b9\u53d1\u751f\u53d8\u5316\uff0c\u53ea\u4fee\u6539\u8fd9\u4e2a\u8282\u70b9\u548c\u53d7\u5b83\u5f71\u54cd\u7684\u7236\u8282\u70b9\uff0c\u5176\u5b83\u8282\u70b9\u5219\u8fdb\u884c\u5171\u4eab"}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://pic4.zhimg.com/80/2b4c801a7b40eefcd4ee6767fb984fdf_720w.gif",alt:""})}),"\n",(0,t.jsx)(n.h2,{id:"\u4e8c\u5982\u4f55\u4f7f\u7528",children:"\u4e8c\u3001\u5982\u4f55\u4f7f\u7528"}),"\n",(0,t.jsxs)(n.p,{children:["\u4f7f\u7528",(0,t.jsx)(n.code,{children:"Immutable"}),"\u5bf9\u8c61\u6700\u4e3b\u8981\u7684\u5e93\u662f",(0,t.jsx)(n.code,{children:"immutable.js"})]}),"\n",(0,t.jsx)(n.p,{children:"immutable.js \u662f\u4e00\u4e2a\u5b8c\u5168\u72ec\u7acb\u7684\u5e93\uff0c\u65e0\u8bba\u57fa\u4e8e\u4ec0\u4e48\u6846\u67b6\u90fd\u53ef\u4ee5\u7528\u5b83"}),"\n",(0,t.jsx)(n.p,{children:"\u5176\u51fa\u73b0\u573a\u666f\u5728\u4e8e\u5f25\u8865 Javascript \u6ca1\u6709\u4e0d\u53ef\u53d8\u6570\u636e\u7ed3\u6784\u7684\u95ee\u9898\uff0c\u901a\u8fc7 structural sharing \u6765\u89e3\u51b3\u7684\u6027\u80fd\u95ee\u9898"}),"\n",(0,t.jsxs)(n.p,{children:["\u5185\u90e8\u63d0\u4f9b\u4e86\u4e00\u5957\u5b8c\u6574\u7684 Persistent Data Structure\uff0c\u8fd8\u6709\u5f88\u591a\u6613\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5982",(0,t.jsx)(n.code,{children:"Collection"}),"\u3001",(0,t.jsx)(n.code,{children:"List"}),"\u3001",(0,t.jsx)(n.code,{children:"Map"}),"\u3001",(0,t.jsx)(n.code,{children:"Set"}),"\u3001",(0,t.jsx)(n.code,{children:"Record"}),"\u3001",(0,t.jsx)(n.code,{children:"Seq"}),"\uff0c\u5176\u4e2d\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"List: \u6709\u5e8f\u7d22\u5f15\u96c6\uff0c\u7c7b\u4f3c JavaScript \u4e2d\u7684 Array"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Map: \u65e0\u5e8f\u7d22\u5f15\u96c6\uff0c\u7c7b\u4f3c JavaScript \u4e2d\u7684 Object"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Set: \u6ca1\u6709\u91cd\u590d\u503c\u7684\u96c6\u5408"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u4e3b\u8981\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"fromJS()\uff1a\u5c06\u4e00\u4e2a js \u6570\u636e\u8f6c\u6362\u4e3a Immutable \u7c7b\u578b\u7684\u6570\u636e"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const obj = Immutable.fromJS({ a: "123", b: "234" });\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"toJS()\uff1a\u5c06\u4e00\u4e2a Immutable \u6570\u636e\u8f6c\u6362\u4e3a JS \u7c7b\u578b\u7684\u6570\u636e"}),"\n",(0,t.jsx)(n.li,{children:"is()\uff1a\u5bf9\u4e24\u4e2a\u5bf9\u8c61\u8fdb\u884c\u6bd4\u8f83"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import { Map, is } from "immutable";\r\nconst map1 = Map({ a: 1, b: 1, c: 1 });\r\nconst map2 = Map({ a: 1, b: 1, c: 1 });\r\nmap1 === map2; //false\r\nObject.is(map1, map2); // false\r\nis(map1, map2); // true\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"get(key)\uff1a\u5bf9\u6570\u636e\u6216\u5bf9\u8c61\u53d6\u503c"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"getIn([]) \uff1a\u5bf9\u5d4c\u5957\u5bf9\u8c61\u6216\u6570\u7ec4\u53d6\u503c\uff0c\u4f20\u53c2\u4e3a\u6570\u7ec4\uff0c\u8868\u793a\u4f4d\u7f6e"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'let abs = Immutable.fromJS({ a: { b: 2 } });\r\nabs.getIn(["a", "b"]); // 2\r\nabs.getIn(["a", "c"]); // \u5b50\u7ea7\u6ca1\u6709\u503c\r\n\r\nlet arr = Immutable.fromJS([1, 2, 3, { a: 5 }]);\r\narr.getIn([3, "a"]); // 5\r\narr.getIn([3, "c"]); // \u5b50\u7ea7\u6ca1\u6709\u503c\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u4e0b\u4f8b\u5b50\uff1a\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import Immutable from "immutable";\r\nfoo = Immutable.fromJS({ a: { b: 1 } });\r\nbar = foo.setIn(["a", "b"], 2); // \u4f7f\u7528 setIn \u8d4b\u503c\r\nconsole.log(foo.getIn(["a", "b"])); // \u4f7f\u7528 getIn \u53d6\u503c\uff0c\u6253\u5370 1\r\nconsole.log(foo === bar); //  \u6253\u5370 false\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u5982\u679c\u6362\u5230\u539f\u751f\u7684",(0,t.jsx)(n.code,{children:"js"}),"\uff0c\u5219\u5bf9\u5e94\u5982\u4e0b\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"let foo = { a: { b: 1 } };\r\nlet bar = foo;\r\nbar.a.b = 2;\r\nconsole.log(foo.a.b); // \u6253\u5370 2\r\nconsole.log(foo === bar); //  \u6253\u5370 true\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u4e09\u5728-react-\u4e2d\u5e94\u7528",children:"\u4e09\u3001\u5728 React \u4e2d\u5e94\u7528"}),"\n",(0,t.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"Immutable "}),"\u53ef\u4ee5\u7ed9 ",(0,t.jsx)(n.code,{children:"React"})," \u5e94\u7528\u5e26\u6765\u6027\u80fd\u7684\u4f18\u5316\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u51cf\u5c11\u6e32\u67d3\u7684\u6b21\u6570"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u505a",(0,t.jsx)(n.code,{children:"react"}),"\u6027\u80fd\u4f18\u5316\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u6e32\u67d3\uff0c\u6211\u4eec\u4f1a\u5728",(0,t.jsx)(n.code,{children:"shouldComponentUpdate()"}),"\u4e2d\u505a\u5bf9\u6bd4\uff0c\u5f53\u8fd4\u56de",(0,t.jsx)(n.code,{children:"true"}),"\u6267\u884c",(0,t.jsx)(n.code,{children:"render"}),"\u65b9\u6cd5"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Immutable"}),"\u901a\u8fc7",(0,t.jsx)(n.code,{children:"is"}),"\u65b9\u6cd5\u5219\u53ef\u4ee5\u5b8c\u6210\u5bf9\u6bd4\uff0c\u800c\u65e0\u9700\u50cf\u4e00\u6837\u901a\u8fc7\u6df1\u5ea6\u6bd4\u8f83\u7684\u65b9\u5f0f\u6bd4\u8f83"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u4f7f\u7528",(0,t.jsx)(n.code,{children:"redux"}),"\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u7ed3\u5408",(0,t.jsx)(n.code,{children:"Immutable"}),"\uff0c\u4e0d\u4f7f\u7528",(0,t.jsx)(n.code,{children:"Immutable"}),"\u524d\u4fee\u6539\u4e00\u4e2a\u6570\u636e\u9700\u8981\u505a\u4e00\u4e2a\u6df1\u62f7\u8d1d"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import '_' from 'lodash';\r\n\r\nconst Component = React.createClass({\r\n  getInitialState() {\r\n    return {\r\n      data: { times: 0 }\r\n    }\r\n  },\r\n  handleAdd() {\r\n    let data = _.cloneDeep(this.state.data);\r\n    data.times = data.times + 1;\r\n    this.setState({ data: data });\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u4f7f\u7528 Immutable \u540e\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"getInitialState() {\r\n  return {\r\n    data: Map({ times: 0 })\r\n  }\r\n},\r\n  handleAdd() {\r\n    this.setState({ data: this.state.data.update('times', v => v + 1) });\r\n    // \u8fd9\u65f6\u7684 times \u5e76\u4e0d\u4f1a\u6539\u53d8\r\n    console.log(this.state.data.get('times'));\r\n  }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u540c\u7406\uff0c\u5728",(0,t.jsx)(n.code,{children:"redux"}),"\u4e2d\u4e5f\u53ef\u4ee5\u5c06\u6570\u636e\u8fdb\u884c",(0,t.jsx)(n.code,{children:"fromJS"}),"\u5904\u7406"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import * as constants from "./constants";\r\nimport { fromJS } from "immutable";\r\nconst defaultState = fromJS({\r\n  //\u5c06\u6570\u636e\u8f6c\u5316\u6210immutable\u6570\u636e\r\n  home: true,\r\n  focused: false,\r\n  mouseIn: false,\r\n  list: [],\r\n  page: 1,\r\n  totalPage: 1,\r\n});\r\nexport default (state = defaultState, action) => {\r\n  switch (action.type) {\r\n    case constants.SEARCH_FOCUS:\r\n      return state.set("focused", true); //\u66f4\u6539immutable\u6570\u636e\r\n    case constants.CHANGE_HOME_ACTIVE:\r\n      return state.set("home", action.value);\r\n    case constants.SEARCH_BLUR:\r\n      return state.set("focused", false);\r\n    case constants.CHANGE_LIST:\r\n      // return state.set(\'list\',action.data).set(\'totalPage\',action.totalPage)\r\n      //merge\u6548\u7387\u66f4\u9ad8\uff0c\u6267\u884c\u4e00\u6b21\u6539\u53d8\u591a\u4e2a\u6570\u636e\r\n      return state.merge({\r\n        list: action.data,\r\n        totalPage: action.totalPage,\r\n      });\r\n    case constants.MOUSE_ENTER:\r\n      return state.set("mouseIn", true);\r\n    case constants.MOUSE_LEAVE:\r\n      return state.set("mouseIn", false);\r\n    case constants.CHANGE_PAGE:\r\n      return state.set("page", action.page);\r\n    default:\r\n      return state;\r\n  }\r\n};\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u53c2\u8003\u6587\u732e",children:"\u53c2\u8003\u6587\u732e"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/20295971?spm=a2c4e.11153940.blogcont69516.18.4f275a00EzBHjr&columnSlug=purerender",children:"https://zhuanlan.zhihu.com/p/20295971?spm=a2c4e.11153940.blogcont69516.18.4f275a00EzBHjr&columnSlug=purerender"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.jianshu.com/p/7bf04638e82a",children:"https://www.jianshu.com/p/7bf04638e82a"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>c});var t=r(67294);const s={},a=t.createContext(s);function c(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);