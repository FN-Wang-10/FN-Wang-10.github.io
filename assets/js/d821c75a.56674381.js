"use strict";(self.webpackChunkfn_wang_10_github_io=self.webpackChunkfn_wang_10_github_io||[]).push([[81220],{35495:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var l=n(74848),s=n(28453);const i={},t=void 0,a={id:"\u6d4f\u89c8\u5668/requestIdleCallbeck",title:"requestIdleCallbeck",description:"\u6d4f\u89c8\u5668\u4e00\u822c\u7684\u5237\u65b0\u9891\u7387\u4e3a 60hz\uff0c\u4e5f\u5c31\u662f\u6bcf\u79d2\u5237\u65b0 60 \u6b21\uff0c\u90a3\u4e48\u6bcf\u5e27\u7684\u65f6\u957f\u5c31\u662f 16.6ms(1000ms/60)",source:"@site/docs/\u6d4f\u89c8\u5668/requestIdleCallbeck.md",sourceDirName:"\u6d4f\u89c8\u5668",slug:"/\u6d4f\u89c8\u5668/requestIdleCallbeck",permalink:"/docs/\u6d4f\u89c8\u5668/requestIdleCallbeck",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"browserSidebar",previous:{title:"requestIdleCallback,requestAnimationFrame",permalink:"/docs/\u6d4f\u89c8\u5668/requestIdleCallback,requestAnimationFrame"},next:{title:"url\u5230\u9875\u9762\u5448\u73b0\uff0c\u53d1\u751f\u4e86\u4ec0\u4e48",permalink:"/docs/\u6d4f\u89c8\u5668/url\u5230\u9875\u9762\u5448\u73b0\uff0c\u53d1\u751f\u4e86\u4ec0\u4e48"}},o={},c=[{value:"requestidlecallback",id:"requestidlecallback",level:2},{value:"requestidlecallback \u6267\u884c\u9636\u6bb5",id:"requestidlecallback-\u6267\u884c\u9636\u6bb5",level:2},{value:"\u6d4f\u89c8\u5668\u5728\u4e00\u5e27\u4e2d\u505a\u4e86\u4ec0\u4e48",id:"\u6d4f\u89c8\u5668\u5728\u4e00\u5e27\u4e2d\u505a\u4e86\u4ec0\u4e48",level:3},{value:"requestidlecallback \u57fa\u672c\u7528\u6cd5",id:"requestidlecallback-\u57fa\u672c\u7528\u6cd5",level:2},{value:"\u9762\u8bd5\u5b98\u53ef\u80fd\u4f1a\u95ee\u7684\u95ee\u9898",id:"\u9762\u8bd5\u5b98\u53ef\u80fd\u4f1a\u95ee\u7684\u95ee\u9898",level:2},{value:"requestIdleCallback \u66ff\u4ee3\u65b9\u6848\u662f\u4ec0\u4e48?",id:"requestidlecallback-\u66ff\u4ee3\u65b9\u6848\u662f\u4ec0\u4e48",level:3},{value:"MessageChannel \u57fa\u672c\u7528\u6cd5",id:"messagechannel-\u57fa\u672c\u7528\u6cd5",level:4},{value:"\u5b9e\u73b0 react \u7b80\u6613\u7248\u8c03\u5ea6\u5668",id:"\u5b9e\u73b0-react-\u7b80\u6613\u7248\u8c03\u5ea6\u5668",level:4}];function d(e){const r={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.p,{children:"\u6d4f\u89c8\u5668\u4e00\u822c\u7684\u5237\u65b0\u9891\u7387\u4e3a 60hz\uff0c\u4e5f\u5c31\u662f\u6bcf\u79d2\u5237\u65b0 60 \u6b21\uff0c\u90a3\u4e48\u6bcf\u5e27\u7684\u65f6\u957f\u5c31\u662f 16.6ms(1000ms/60)"}),"\n",(0,l.jsx)(r.h2,{id:"requestidlecallback",children:"requestidlecallback"}),"\n",(0,l.jsx)(r.p,{children:"\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\uff0c\u5141\u8bb8\u5f00\u53d1\u8005\u5728\u6d4f\u89c8\u5668\u7a7a\u95f2\u65f6\u8fd0\u884c\u4f4e\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5173\u952e\u4efb\u52a1\u548c\u52a8\u753b\u7684\u6027\u80fd\u3002"}),"\n",(0,l.jsx)(r.h2,{id:"requestidlecallback-\u6267\u884c\u9636\u6bb5",children:"requestidlecallback \u6267\u884c\u9636\u6bb5"}),"\n",(0,l.jsx)(r.h3,{id:"\u6d4f\u89c8\u5668\u5728\u4e00\u5e27\u4e2d\u505a\u4e86\u4ec0\u4e48",children:"\u6d4f\u89c8\u5668\u5728\u4e00\u5e27\u4e2d\u505a\u4e86\u4ec0\u4e48"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsx)(r.li,{children:"\u5904\u7406\u4e8b\u4ef6\u7684\u56de\u8c03 click...\u4e8b\u4ef6"}),"\n",(0,l.jsx)(r.li,{children:"\u5904\u7406\u8ba1\u65f6\u5668\u7684\u56de\u8c03\uff08EventLoop \u4e8b\u4ef6\u5faa\u73af\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5f00\u59cb\u5e27"}),"\n",(0,l.jsx)(r.li,{children:"\u6267\u884c requestAnimationFrame \u52a8\u753b\u7684\u56de\u8c03"}),"\n",(0,l.jsx)(r.li,{children:"\u8ba1\u7b97\u673a\u9875\u9762\u5e03\u5c40\u8ba1\u7b97 \u5408\u5e76\u5230\u4e3b\u7ebf\u7a0b"}),"\n",(0,l.jsx)(r.li,{children:"\u7ed8\u5236"}),"\n",(0,l.jsx)(r.li,{children:"\u5982\u679c\u6b64\u65f6\u8fd8\u6709\u7a7a\u95f2\u65f6\u95f4\uff0c\u6267\u884c requestIdleCallback\uff08\u5982\u679c\u6267\u884c\u5b8c\u4e0a\u9762\u7684\u516d\u4e2a\u4e4b\u540e\u8fd8\u6709\u7a7a\u95f2\u65f6\u95f4\u5c31\u4f1a\u6267\u884c requestIdleCallback\uff0c\u5426\u5219\u5c31\u4e0d\u4f1a\u6267\u884c\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"requestidlecallback-\u57fa\u672c\u7528\u6cd5",children:"requestidlecallback \u57fa\u672c\u7528\u6cd5"}),"\n",(0,l.jsx)(r.p,{children:"requestidlecallback \u63a5\u53d7\u4e00\u4e2a\u56de\u8c03\u51fd\u6570 callback \u5e76\u4e14\u5728\u56de\u8c03\u51fd\u6570\u4e2d\u4f1a\u6ce8\u5165\u53c2\u6570 deadline"}),"\n",(0,l.jsxs)(r.p,{children:["deadline \u6709\u4e24\u4e2a\u503c:",(0,l.jsx)(r.br,{}),"\n","deadline.timeRemaining() \u8fd4\u56de\u662f\u5426\u8fd8\u6709\u7a7a\u95f2\u65f6\u95f4(\u6beb\u79d2)",(0,l.jsx)(r.br,{}),"\n","deadline.didTimeout \u8fd4\u56de\u662f\u5426\u56e0\u4e3a\u8d85\u65f6\u88ab\u5f3a\u5236\u6267\u884c(\u5e03\u5c14\u503c)"]}),"\n",(0,l.jsxs)(r.p,{children:["options:\r\n",(0,l.jsx)(r.code,{children:"{ timeout: 1000 }"})," \u6307\u5b9a\u56de\u8c03\u7684\u6700\u5927\u7b49\u5f85\u65f6\u95f4\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\u3002\u5982\u679c\u5728\u6307\u5b9a\u7684 timeout \u65f6\u95f4\u5185\u6ca1\u6709\u7a7a\u95f2\u65f6\u95f4\uff0c\u56de\u8c03\u4f1a\u5f3a\u5236\u6267\u884c\uff0c\u907f\u514d\u4efb\u52a1\u65e0\u9650\u671f\u63a8\u8fdf\r\n\u8fd9\u4e2a\u6848\u4f8b\u6a21\u62df\u4e86\u5728\u6d4f\u89c8\u5668\u7a7a\u95f2\u65f6\uff0c\u6e32\u67d3 1000 \u6761 dom \u5143\u7d20\uff0c\u975e\u5e38\u6d41\u7545"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:"const total = 1000; // \u5b9a\u4e49\u9700\u8981\u751f\u6210\u7684\u51fd\u6570\u6570\u91cf\uff0c\u53731000\u4e2a\u4efb\u52a1\r\nconst arr = []; // \u5b58\u50a8\u4efb\u52a1\u51fd\u6570\u7684\u6570\u7ec4\r\n\r\n// \u751f\u62101000\u4e2a\u51fd\u6570\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u6570\u7ec4\u4e2d\r\nfunction generateArr() {\r\n  for (let i = 0; i < total; i++) {\r\n    // \u6bcf\u4e2a\u51fd\u6570\u7684\u4f5c\u7528\u662f\u5c06\u4e00\u4e2a <div> \u5143\u7d20\u63d2\u5165\u5230\u9875\u9762\u7684 body \u4e2d\r\n    arr.push(function () {\r\n      document.body.innerHTML += `<div>${i + 1}</div>`; // \u5c06\u5f53\u524d\u7d22\u5f15 + 1 \u4f5c\u4e3a\u5185\u5bb9\r\n    });\r\n  }\r\n}\r\ngenerateArr(); // \u8c03\u7528\u51fd\u6570\u751f\u6210\u4efb\u52a1\u6570\u7ec4\r\n\r\n// \u7528\u4e8e\u8c03\u5ea6\u548c\u6267\u884c\u4efb\u52a1\u7684\u51fd\u6570\r\nfunction workLoop(deadline) {\r\n  // \u68c0\u67e5\u5f53\u524d\u7a7a\u95f2\u65f6\u95f4\u662f\u5426\u5927\u4e8e1\u6beb\u79d2\uff0c\u5e76\u4e14\u4efb\u52a1\u6570\u7ec4\u4e2d\u8fd8\u6709\u4efb\u52a1\u672a\u6267\u884c\r\n  if (deadline.timeRemaining() > 1 && arr.length > 0) {\r\n    const fn = arr.shift(); // \u4ece\u4efb\u52a1\u6570\u7ec4\u4e2d\u53d6\u51fa\u7b2c\u4e00\u4e2a\u51fd\u6570\r\n    fn(); // \u6267\u884c\u8be5\u51fd\u6570\uff0c\u5373\u63d2\u5165\u5bf9\u5e94\u7684 <div> \u5143\u7d20\u5230\u9875\u9762\u4e2d\r\n  }\r\n  // \u518d\u6b21\u4f7f\u7528 requestIdleCallback \u8c03\u5ea6\u4e0b\u4e00\u4e2a\u7a7a\u95f2\u65f6\u95f4\u6267\u884c\u4efb\u52a1\r\n  requestIdleCallback(workLoop);\r\n}\r\n\r\n// \u5f00\u59cb\u8c03\u5ea6\u4efb\u52a1\uff0c\u5728\u6d4f\u89c8\u5668\u7a7a\u95f2\u65f6\u6267\u884c workLoop\r\nrequestIdleCallback(workLoop, { timeout: 1000 });\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u9762\u8bd5\u5b98\u53ef\u80fd\u4f1a\u95ee\u7684\u95ee\u9898",children:"\u9762\u8bd5\u5b98\u53ef\u80fd\u4f1a\u95ee\u7684\u95ee\u9898"}),"\n",(0,l.jsx)(r.p,{children:"\u4e3a\u4ec0\u4e48 React \u4e0d\u7528\u539f\u751f requestIdleCallback \u5b9e\u73b0\u5462\uff1f"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsxs)(r.li,{children:["\u517c\u5bb9\u6027\u5dee Safari \u5e76\u4e0d\u652f\u6301(\u5982\u4e0b\u9644\u56fe) ",(0,l.jsx)(r.a,{href:"https://caniuse.com/?search=requestIdleCallback",children:"https://caniuse.com/?search=requestIdleCallback"})]}),"\n",(0,l.jsx)(r.li,{children:"\u63a7\u5236\u7cbe\u7ec6\u5ea6 React \u8981\u6839\u636e\u7ec4\u4ef6\u4f18\u5148\u7ea7\u3001\u66f4\u65b0\u7684\u7d27\u6025\u7a0b\u5ea6\u7b49\u4fe1\u606f\uff0c\u66f4\u7cbe\u786e\u5730\u5b89\u6392\u6e32\u67d3\u7684\u5de5\u4f5c"}),"\n",(0,l.jsx)(r.li,{children:"\u6267\u884c\u65f6\u673a requestIdleCallback(callback) \u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\u95f4\u9694\u662f 50ms\uff08W3C \u89c4\u5b9a\uff09\uff0c\u4e5f\u5c31\u662f 20FPS\uff0c1 \u79d2\u5185\u6267\u884c 20 \u6b21\uff0c\u95f4\u9694\u8f83\u957f\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u5dee\u5f02\u6027 \u6bcf\u4e2a\u6d4f\u89c8\u5668\u5b9e\u73b0\u8be5 API \u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u5bfc\u81f4\u6267\u884c\u65f6\u673a\u6709\u5dee\u5f02\u6709\u7684\u5feb\u6709\u7684\u6162\r\n",(0,l.jsx)(r.img,{src:n(47158).A+"",width:"1435",height:"698"})]}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"requestidlecallback-\u66ff\u4ee3\u65b9\u6848\u662f\u4ec0\u4e48",children:"requestIdleCallback \u66ff\u4ee3\u65b9\u6848\u662f\u4ec0\u4e48?"}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"MessageChannel"})}),"\n",(0,l.jsx)(r.p,{children:"\u9009\u62e9 MessageChannel \u7684\u539f\u56e0\uff0c\u662f\u9996\u5148\u5f02\u6b65\u5f97\u662f\u4e2a\u5b8f\u4efb\u52a1\uff0c\u56e0\u4e3a\u5b8f\u4efb\u52a1\u4e2d\u4f1a\u5728\u4e0b\u6b21\u4e8b\u4ef6\u5faa\u73af\u4e2d\u6267\u884c\uff0c\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u9875\u9762\u7684\u66f4\u65b0\u3002MessageChannel \u662f\u4e00\u4e2a\u5b8f\u4efb\u52a1\u3002"}),"\n",(0,l.jsx)(r.p,{children:"\u6ca1\u9009\u5e38\u89c1\u7684 setTimeout\uff0c\u662f\u56e0\u4e3a MessageChannel \u80fd\u8f83\u5feb\u6267\u884c\uff0c\u5728 0 \uff5e 1ms \u5185\u89e6\u53d1\uff0c\u50cf setTimeout \u5373\u4fbf\u8bbe\u7f6e timeout \u4e3a 0 \u8fd8\u662f\u9700\u8981 4 \uff5e 5ms\u3002\u76f8\u540c\u65f6\u95f4\u4e0b\uff0cMessageChannel \u80fd\u591f\u5b8c\u6210\u66f4\u591a\u7684\u4efb\u52a1\u3002"}),"\n",(0,l.jsxs)(r.p,{children:["MDN ",(0,l.jsx)(r.a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout",children:"https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout"}),(0,l.jsx)(r.br,{}),"\n","\u82e5\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 MessageChannel\uff0c\u8fd8\u662f\u5f97\u964d\u7ea7\u4e3a setTimeout\u3002"]}),"\n",(0,l.jsx)(r.h4,{id:"messagechannel-\u57fa\u672c\u7528\u6cd5",children:"MessageChannel \u57fa\u672c\u7528\u6cd5"}),"\n",(0,l.jsx)(r.p,{children:"MessageChanne \u8bbe\u8ba1\u521d\u8877\u662f\u4e3a\u4e86\u65b9\u4fbf \u6211\u4eec\u5728\u4e0d\u540c\u7684\u4e0a\u4e0b\u6587\u4e4b\u95f4\u8fdb\u884c\u901a\u8baf\uff0c\u4f8b\u5982 web Worker,iframe \u5b83\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7aef\u53e3\uff08port1 \u548c port2\uff09\uff0c\u901a\u8fc7\u8fd9\u4e9b\u7aef\u53e3\uff0c\u6d88\u606f\u53ef\u4ee5\u5728\u4e24\u4e2a\u72ec\u7acb\u7684\u7ebf\u7a0b\u4e4b\u95f4\u53cc\u5411\u4f20\u9012"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:"// \u521b\u5efa MessageChannel\r\nconst channel = new MessageChannel();\r\nconst port1 = channel.port1;\r\nconst port2 = channel.port2;\r\n\r\n// \u8bbe\u7f6e port1 \u7684\u6d88\u606f\u5904\u7406\u51fd\u6570\r\nport1.onmessage = (event) => {\r\n  console.log('Received by port1:', event.data);\r\n  port1.postMessage('Reply from port1'); // \u5411 port2 \u53d1\u9001\u56de\u590d\u6d88\u606f\r\n};\r\n\r\n// \u8bbe\u7f6e port2 \u7684\u6d88\u606f\u5904\u7406\u51fd\u6570\r\nport2.onmessage = (event) => {\r\n  console.log('Received by port2:', event.data);\r\n};\r\n\r\n// \u901a\u8fc7 port2 \u53d1\u9001\u6d88\u606f\u7ed9 port1\r\nport2.postMessage('Message from port2');\n"})}),"\n",(0,l.jsx)(r.h4,{id:"\u5b9e\u73b0-react-\u7b80\u6613\u7248\u8c03\u5ea6\u5668",children:"\u5b9e\u73b0 react \u7b80\u6613\u7248\u8c03\u5ea6\u5668"}),"\n",(0,l.jsx)(r.p,{children:"React \u8c03\u5ea6\u5668\u7ed9\u6bcf\u4e00\u4e2a\u4efb\u52a1\u5206\u914d\u4e86\u4f18\u5148\u7ea7"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsx)(r.li,{children:"ImmediatePriority : \u7acb\u5373\u6267\u884c\u7684\u4f18\u5148\u7ea7\uff0c\u7ea7\u522b\u6700\u9ad8"}),"\n",(0,l.jsx)(r.li,{children:"UserBlockingPriority : \u7528\u6237\u963b\u585e\u7ea7\u522b\u7684\u4f18\u5148\u7ea7"}),"\n",(0,l.jsx)(r.li,{children:"NormalPriority : \u6b63\u5e38\u7684\u4f18\u5148\u7ea7"}),"\n",(0,l.jsx)(r.li,{children:"LowPriority : \u4f4e\u4f18\u5148\u7ea7"}),"\n",(0,l.jsx)(r.li,{children:"IdlePriority : \u6700\u4f4e\u9636\u7684\u4f18\u5148\u7ea7"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"\u540c\u65f6\u8fd8\u7ed9\u6bcf\u4e2a\u4efb\u52a1\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u8fc7\u671f\u65f6\u95f4\u8d8a\u77ed\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8"}),"\n",(0,l.jsx)(r.p,{children:"\u58f0\u660e taskQueue \u4e3a\u6570\u7ec4\uff0c\u5b58\u50a8\u6bcf\u4e2a\u4efb\u52a1\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u4f18\u5148\u7ea7\uff0c\u8fc7\u671f\u65f6\u95f4\uff0c\u56de\u8c03\u51fd\u6570"}),"\n",(0,l.jsx)(r.p,{children:"\u58f0\u660e isPerformingWork \u4e3a\u5e03\u5c14\u503c\uff0c\u8868\u793a\u5f53\u524d\u662f\u5426\u5728\u6267\u884c\u4efb\u52a1"}),"\n",(0,l.jsx)(r.p,{children:"\u58f0\u660e port \u4e3a MessageChannel\uff0c\u7528\u4e8e\u53d1\u9001\u548c\u63a5\u6536\u6d88\u606f"}),"\n",(0,l.jsx)(r.p,{children:"\u7136\u540e\u5c06\u4efb\u52a1\u6dfb\u52a0\u5230\u961f\u5217\u91cc\u9762\uff0c\u5e76\u4e14\u6dfb\u52a0\u8fdb\u53bb\u7684\u65f6\u5019\u8fd8\u9700\u8981\u6839\u636e\u4f18\u5148\u7ea7\u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u8c03\u7528 workLoop \u6267\u884c\u4efb\u52a1"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:"const ImmediatePriority = 1; // \u7acb\u5373\u6267\u884c\u7684\u4f18\u5148\u7ea7, \u7ea7\u522b\u6700\u9ad8 [\u70b9\u51fb\u4e8b\u4ef6\uff0c\u8f93\u5165\u6846\uff0c]\r\nconst UserBlockingPriority = 2; // \u7528\u6237\u963b\u585e\u7ea7\u522b\u7684\u4f18\u5148\u7ea7, [\u6eda\u52a8\uff0c\u62d6\u62fd\u8fd9\u4e9b]\r\nconst NormalPriority = 3; // \u6b63\u5e38\u7684\u4f18\u5148\u7ea7 [redner \u5217\u8868 \u52a8\u753b \u7f51\u7edc\u8bf7\u6c42]\r\nconst LowPriority = 4; // \u4f4e\u4f18\u5148\u7ea7  [\u5206\u6790\u7edf\u8ba1]\r\nconst IdlePriority = 5; // \u6700\u4f4e\u9636\u7684\u4f18\u5148\u7ea7, \u53ef\u4ee5\u88ab\u95f2\u7f6e\u7684\u90a3\u79cd [console.log]\r\n\r\n// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\r\nfunction getCurrentTime() {\r\n  return performance.now();\r\n}\r\n\r\nclass SimpleScheduler {\r\n  constructor() {\r\n    this.taskQueue = []; // \u4efb\u52a1\u961f\u5217\r\n    this.isPerformingWork = false; // \u5f53\u524d\u662f\u5426\u5728\u6267\u884c\u4efb\u52a1\r\n\r\n    // \u4f7f\u7528 MessageChannel \u5904\u7406\u4efb\u52a1\u8c03\u5ea6\r\n    const channel = new MessageChannel();\r\n    this.port = channel.port2;\r\n    channel.port1.onmessage = this.performWorkUntilDeadline.bind(this);\r\n  }\r\n\r\n  // \u8c03\u5ea6\u4efb\u52a1\r\n  scheduleCallback(priorityLevel, callback) {\r\n    const curTime = getCurrentTime();\r\n    let timeout;\r\n    // \u6839\u636e\u4f18\u5148\u7ea7\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\r\n    switch (priorityLevel) {\r\n      case ImmediatePriority:\r\n        timeout = -1;\r\n        break;\r\n      case UserBlockingPriority:\r\n        timeout = 250;\r\n        break;\r\n      case LowPriority:\r\n        timeout = 10000;\r\n        break;\r\n      case IdlePriority:\r\n        timeout = 1073741823;\r\n        break;\r\n      case NormalPriority:\r\n      default:\r\n        timeout = 5000;\r\n        break;\r\n    }\r\n\r\n    const task = {\r\n      callback,\r\n      priorityLevel,\r\n      expirationTime: curTime + timeout // \u76f4\u63a5\u6839\u636e\u5f53\u524d\u65f6\u95f4\u52a0\u4e0a\u8d85\u65f6\u65f6\u95f4\r\n    };\r\n\r\n    this.push(this.taskQueue, task); // \u5c06\u4efb\u52a1\u52a0\u5165\u961f\u5217\r\n    this.schedulePerformWorkUntilDeadline();\r\n  }\r\n\r\n  // \u901a\u8fc7 MessageChannel \u8c03\u5ea6\u6267\u884c\u4efb\u52a1\r\n  schedulePerformWorkUntilDeadline() {\r\n    if (!this.isPerformingWork) {\r\n      this.isPerformingWork = true;\r\n      this.port.postMessage(null); // \u89e6\u53d1 MessageChannel \u8c03\u5ea6\r\n    }\r\n  }\r\n\r\n  // \u6267\u884c\u4efb\u52a1\r\n  performWorkUntilDeadline() {\r\n    this.isPerformingWork = true;\r\n    this.workLoop();\r\n    this.isPerformingWork = false;\r\n  }\r\n\r\n  // \u4efb\u52a1\u5faa\u73af\r\n  workLoop() {\r\n    let curTask = this.peek(this.taskQueue);\r\n    while (curTask) {\r\n      const callback = curTask.callback;\r\n      if (typeof callback === 'function') {\r\n        callback(); // \u6267\u884c\u4efb\u52a1\r\n      }\r\n      this.pop(this.taskQueue); // \u79fb\u9664\u5df2\u5b8c\u6210\u4efb\u52a1\r\n      curTask = this.peek(this.taskQueue); // \u83b7\u53d6\u4e0b\u4e00\u4e2a\u4efb\u52a1\r\n    }\r\n  }\r\n\r\n  // \u83b7\u53d6\u961f\u5217\u4e2d\u7684\u4efb\u52a1\r\n  peek(queue) {\r\n    return queue[0] || null;\r\n  }\r\n\r\n  // \u5411\u961f\u5217\u4e2d\u6dfb\u52a0\u4efb\u52a1\r\n  push(queue, task) {\r\n    queue.push(task);\r\n    queue.sort((a, b) => a.expirationTime - b.expirationTime); // \u6839\u636e\u4f18\u5148\u7ea7\u6392\u5e8f\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u5728\u524d \u4ece\u5c0f\u5230\u5927\r\n  }\r\n\r\n  // \u4ece\u961f\u5217\u4e2d\u79fb\u9664\u4efb\u52a1\r\n  pop(queue) {\r\n    return queue.shift();\r\n  }\r\n}\r\n\r\n// \u6d4b\u8bd5\r\nconst scheduler = new SimpleScheduler();\r\n\r\nscheduler.scheduleCallback(LowPriority, () => {\r\n  console.log('Task 1: Low Priority');\r\n});\r\n\r\nscheduler.scheduleCallback(ImmediatePriority, () => {\r\n  console.log('Task 2: Immediate Priority');\r\n});\r\n\r\nscheduler.scheduleCallback(IdlePriority, () => {\r\n  console.log('Task 3: Idle Priority');\r\n});\r\n\r\nscheduler.scheduleCallback(UserBlockingPriority, () => {\r\n  console.log('Task 4: User Blocking Priority');\r\n});\r\n\r\nscheduler.scheduleCallback(NormalPriority, () => {\r\n  console.log('Task 5: Normal Priority');\r\n});\n"})}),"\n",(0,l.jsx)(r.p,{children:"\u6267\u884c\u987a\u5e8f\u4e3a 2 4 5 1 3"})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,l.jsx)(r,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},47158:(e,r,n)=>{n.d(r,{A:()=>l});const l=n.p+"assets/images/S11-aa10b3544b863f3466c0c0237e867862.png"},28453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>a});var l=n(96540);const s={},i=l.createContext(s);function t(e){const r=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),l.createElement(i.Provider,{value:r},e.children)}}}]);