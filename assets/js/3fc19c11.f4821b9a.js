"use strict";(self.webpackChunkfn_wang_10_github_io=self.webpackChunkfn_wang_10_github_io||[]).push([[25408],{45639:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>c,metadata:()=>a,toc:()=>p});var s=e(85893),t=e(11151);const c={},o=void 0,a={id:"\u6d4f\u89c8\u5668/JSONP\u7684\u539f\u7406",title:"JSONP\u7684\u539f\u7406",description:"\u7531\u4e8e\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\u9650\u5236\uff0c\u4e0d\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\uff1b\u4f46\u662f\u9875\u9762\u4e2d\u7684 script\u3001img\u3001iframe \u6807\u7b7e\u662f\u4f8b\u5916\uff0c\u4e0d\u53d7\u540c\u6e90\u7b56\u7565\u9650\u5236\u3002",source:"@site/docs/\u6d4f\u89c8\u5668/JSONP\u7684\u539f\u7406.md",sourceDirName:"\u6d4f\u89c8\u5668",slug:"/\u6d4f\u89c8\u5668/JSONP\u7684\u539f\u7406",permalink:"/docs/\u6d4f\u89c8\u5668/JSONP\u7684\u539f\u7406",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"browserSidebar",previous:{title:"DNS\u534f\u8bae \u662f\u4ec0\u4e48DNS \u5b8c\u6574\u7684\u67e5\u8be2\u8fc7\u7a0b",permalink:"/docs/\u6d4f\u89c8\u5668/DNS\u534f\u8bae \u662f\u4ec0\u4e48DNS \u5b8c\u6574\u7684\u67e5\u8be2\u8fc7\u7a0b"},next:{title:"url\u5230\u9875\u9762\u5448\u73b0\uff0c\u53d1\u751f\u4e86\u4ec0\u4e48",permalink:"/docs/\u6d4f\u89c8\u5668/url\u5230\u9875\u9762\u5448\u73b0\uff0c\u53d1\u751f\u4e86\u4ec0\u4e48"}},i={},p=[];function l(n){const r={a:"a",br:"br",code:"code",img:"img",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.p,{children:"\u7531\u4e8e\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\u9650\u5236\uff0c\u4e0d\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\uff1b\u4f46\u662f\u9875\u9762\u4e2d\u7684 script\u3001img\u3001iframe \u6807\u7b7e\u662f\u4f8b\u5916\uff0c\u4e0d\u53d7\u540c\u6e90\u7b56\u7565\u9650\u5236\u3002"}),"\n",(0,s.jsx)(r.p,{children:"\u5728\u6ca1\u6709 CORS \u65b9\u6cd5\u7684\u5e74\u4ee3\uff0cJSONP \u5c31\u662f\u6700\u4f73\u65b9\u6cd5"}),"\n",(0,s.jsx)(r.p,{children:"\u5728\u540c\u6e90\u7b56\u7565\u4e2d\uff0c\u5bf9\u6807\u7b7e\u7684\u8de8\u57df\u8bf7\u6c42\u9650\u5236\u8f83\u5c0f\uff0cJSONP \u5c31\u5229\u7528\u4e86\u8fd9\u4e00\u70b9"}),"\n",(0,s.jsxs)(r.p,{children:["\u5728\u9879\u76ee\u5f00\u53d1\u4e2d\u5e38\u5e38\u4f1a\u5f15\u5165\u5916\u94fe\u7684\u56fe\u7247\u3001\u6837\u5f0f\u6587\u4ef6\u3001\u63d2\u4ef6\u7b49\u8d44\u6e90\uff0c\u4f46\u8fd9\u4e9b\u8bf7\u6c42\u5e76\u6ca1\u6709\u5bfc\u81f4\u8de8\u57df\u9519\u8bef\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u8bf7\u6c42\u90fd\u5c5e\u4e8e http \u8bf7\u6c42 \u5e76\u4e0d\u662f\u4f1a\u5f15\u53d1\u8de8\u57df \u95ee\u9898\u7684 Xhr \u8bf7\u6c42",(0,s.jsx)(r.br,{}),"\n","\u7b80\u5355\u6765\u8bf4 script \u6807\u7b7e\u6ca1\u6709\u8de8\u57df\u9650\u5236\u7684\u7279\u6027,\u628a script \u811a\u672c\u7684 src \u6539\u6210\u6211\u9700\u8981\u8de8\u57df\u8bf7\u6c42\u7684 url,\u5c31\u80fd\u5b9e\u73b0\u8de8\u57df\u83b7\u53d6\u8d44\u6e90\uff0c\u4e14\u4e0d\u89e6\u53d1\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\uff0c\u8fd9\u5c31\u662f JSONP \u7684\u539f\u7406"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"//\u524d\u7aef\r\n<script>\r\n    window.callback = function (res) {\r\n      console.log(res)\r\n    }\r\n  <\/script>\r\n  <script src =' http://127.0.0.1:8080/jsonp?username=111&callback=callback'> <\/script>\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:'//\u540e\u7aef\r\nconst express = require("express");\r\n\r\nconst router = express.Router();\r\nconst app = express();\r\nrouter.get("/jsonp", (req, res) => {\r\n  const { callback, username } = req.query;\r\n\r\n  if (username === "111") {\r\n    const requestData = {\r\n      code: 200,\r\n      status: "\u767b\u5f55\u6210\u529f",\r\n    };\r\n    res.send(`${callback}(${JSON.stringify(requestData)})`);\r\n  }\r\n});\r\n\r\napp.use(router);\r\n\r\napp.listen("8080", () => {\r\n  console.log("api server running at http://127.0.0.1:8080");\r\n});\n'})}),"\n",(0,s.jsx)(r.p,{children:"\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u6211\u4eec\u4e8b\u5148\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u83b7\u53d6\u8de8\u57df\u54cd\u5e94\u6570\u636e\u7684\u56de\u8c03\u51fd\u6570\u5e76\u6302\u8f7d\u5230 window \u5bf9\u8c61\u4e0a\uff0c\u901a\u8fc7\u6ca1\u6709\u540c\u6e90\u7b56\u7565\u9650\u5236\u7684 script \u6807\u7b7e\u53d1\u8d77\u4e00\u4e2a\u8bf7\u6c42\uff08\u5c06\u56de\u8c03\u51fd\u6570\u7684\u540d\u79f0\u653e\u5230\u8fd9\u4e2a\u8bf7\u6c42\u7684 query \u53c2\u6570\u91cc\uff09\uff0c\u7136\u540e\u670d\u52a1\u7aef\u8fd4\u56de\u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\uff0c\u5e76\u5c06\u9700\u8981\u54cd\u5e94\u7684\u6570\u636e\u653e\u5230\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u91cc\uff0c\u524d\u7aef\u7684 script \u6807\u7b7e\u8bf7\u6c42\u5230\u8fd9\u4e2a\u6267\u884c\u7684\u56de\u8c03\u51fd\u6570\u540e\u4f1a\u7acb\u9a6c\u6267\u884c\uff0c\u4e8e\u662f\u5c31\u62ff\u5230\u4e86\u6267\u884c\u7684\u54cd\u5e94\u6570\u636e"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:e(15705).Z+"",width:"2401",height:"134"})}),"\n",(0,s.jsx)(r.p,{children:"\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728\u524d\u7aef\u5bf9 JSONP \u4ee3\u7801\u8fdb\u884c\u4e00\u5c42\u5c01\u88c5"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"const requestData = {\r\n\r\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d4143371aed4f17a732a4d4b616f43f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1919&h=92&s=7900&e=png&b=ffffff)\r\nurl: 'http://127.0.0.1:8080/jsonp',\r\n\r\ndata: {\r\n\r\nusername: 111,\r\n\r\n},\r\n\r\njsonp: 'getMessage'\r\n\r\n}\r\nfunction jsonp(requestData) {\r\n\r\n// \u5bf9\u4f20\u5165\u53c2\u6570\u8fdb\u884c\u5904\u7406\r\n\r\nconst { url, data, jsonp } = requestData;\r\n\r\nlet query = '';\r\n\r\nfor (let key in data) {\r\n\r\nquery += `${key}=${data[key]}&`;\r\n\r\n}\r\n\r\nconst src = `${url}?${query}jsonp=${jsonp}`;\r\n\r\n// \u751f\u6210\u3001\u586b\u5145script\u6807\u7b7e\uff0c\u5728\u9875\u9762\u4e2d\u6302\u8f7d\u8c03\u7528\u63a5\u53e3\r\n\r\nlet scriptTag = document.createElement('script');\r\n\r\nscriptTag.src = src;\r\n\r\ndocument.body.appendChild(scriptTag);\r\n//\u8fd4\u56dePromise\u65b9\u4fbf\u94fe\u5f0f\u8c03\u7528\r\nreturn new Promise((resolve, reject) => {\r\n\r\nwindow[jsonp] = function(rest){\r\n\r\nresolve(rest)\r\n\r\ndocument.body.removeChild(scriptTag)\r\n\r\n}\r\n\r\n})\r\n\r\n}\r\n\r\n//\u8c03\u7528\r\njsonp(requestData).then(function (response) {\r\n\r\nconsole.log(response);\r\n\r\n})\n"})}),"\n",(0,s.jsx)(r.p,{children:"\u5f53\u7136\u4e0a\u8ff0\u53ea\u662f\u7b80\u5355\u7684 JSONP \u5b9e\u73b0\uff0c\u5728\u5b9e\u9645\u7684\u4f7f\u7528\u4e2d JSONP \u8fd8\u5b58\u5728\u8bf8\u591a\u95ee\u9898\uff1a"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"1. CSRF \u653b\u51fb"}),(0,s.jsx)(r.br,{}),"\n","\u5f53\u524d\u7aef\u53d1\u8d77\u4e00\u4e2a\u4f2a\u9020\u7684\u6076\u610f JSONP \u8bf7\u6c42\u65f6\uff0c\u670d\u52a1\u7aef\u7684\u654f\u611f\u4fe1\u606f\uff0c\u5982\u7528\u6237\u7684\u4e2a\u4eba\u4fe1\u606f\uff0c\u5bc6\u7801\u7b49\u5b58\u5728\u6cc4\u9732\u7684\u98ce\u9669\uff0c\u9700\u8981\u901a\u8fc7\u9a8c\u8bc1 JSONP \u7684\u8c03\u7528\u6765\u6e90\uff08Referer\uff09\uff0c\u670d\u52a1\u7aef\u5224\u65ad \xa0Referer\xa0 \u662f\u5426\u662f\u767d\u540d\u5355\uff0c\u6216\u8005\u90e8\u7f72\u968f\u673a \xa0Token\xa0 \u6765\u9632\u5fa1\u653b\u51fb"]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"2. XSS \u6f0f\u6d1e"}),(0,s.jsx)(r.br,{}),"\n","\u4e0d\u4e25\u8c28\u7684 \xa0content-type \u7c7b\u578b\u4f1a\u5bfc\u81f4\u7684 \xa0XSS\xa0 \u6f0f\u6d1e\uff0c\u5982\u679c\u6ca1\u6709\u4e25\u683c\u5b9a\u4e49\u597d \xa0Content-Type\uff0c\u4f8b\u5982 Content-Type: application/json\uff0c\u6216\u8005\u5bf9\u8bf7\u6c42 url \u7684 query \u53c2\u6570\u6ca1\u6709\u8fdb\u884c\u8fc7\u6ee4\uff0c\u5bfc\u81f4\u8bf7\u6c42\u53c2\u6570\u662f\u4e00\u6bb5\u6076\u610f JavaScript \u4ee3\u7801\uff0c\u5e76\u88ab\u670d\u52a1\u7aef\u63a5\u6536\u6267\u884c\u5e76\u8fd4\u56de\uff0c\u90a3\u4e48\u524d\u7aef\u5c31\u4f1a\u6267\u884c\u8fd9\u6bb5\u6076\u610f\u4ee3\u7801\r\n\u901a\u8fc7\u4e25\u683c\u5b9a\u4e49 Content-Type: application/json\uff0c\u7136\u540e\u4e25\u683c\u8fc7\u6ee4 callback \u540e\u7684\u53c2\u6570\u5e76\u4e14\u9650\u5236\u957f\u5ea6\uff08\u8fdb\u884c\u5b57\u7b26\u8f6c\u4e49\uff0c\u4f8b\u5982",(0,s.jsx)(r.code,{children:"<\u6362\u6210&lt"}),"\uff0c",(0,s.jsx)(r.code,{children:">\u6362\u6210&gt"}),"\uff09\u7b49\uff0c\u8fd9\u6837\u8fd4\u56de\u7684\u811a\u672c\u5185\u5bb9\u4f1a\u53d8\u6210\u6587\u672c\u683c\u5f0f\uff0c\u811a\u672c\u5c06\u4e0d\u4f1a\u6267\u884c"]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"3. \u4ec5\u652f\u6301 GET \u8bf7\u6c42\u65b9\u5f0f"}),(0,s.jsx)(r.br,{}),"\n","JSOP \u4ec5\u652f\u6301 GET \u65b9\u5f0f\u7684\u8bf7\u6c42\uff0c\u5bf9\u4e8e POST \u7b49\u5176\u4ed6\u8bf7\u6c42\u65b9\u5f0f\u5e76\u4e0d\u80fd\u4f7f\u7528 JSONP"]}),"\n",(0,s.jsxs)(r.p,{children:["\u53c2\u8003\u6587\u732e",(0,s.jsx)(r.br,{}),"\n",(0,s.jsx)(r.a,{href:"https://juejin.cn/post/7285576848237412387",children:"https://juejin.cn/post/7285576848237412387"})]})]})}function d(n={}){const{wrapper:r}={...(0,t.a)(),...n.components};return r?(0,s.jsx)(r,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},15705:(n,r,e)=>{e.d(r,{Z:()=>s});const s=e.p+"assets/images/cross-ab10014b59bdd712a2df7ce9636dbb4c.png"},11151:(n,r,e)=>{e.d(r,{Z:()=>a,a:()=>o});var s=e(67294);const t={},c=s.createContext(t);function o(n){const r=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function a(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),s.createElement(c.Provider,{value:r},n.children)}}}]);