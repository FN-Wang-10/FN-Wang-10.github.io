<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Nginx/Nginx" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Nginx | fn-wang-10.github.io</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://fn-wang-10.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://fn-wang-10.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://fn-wang-10.github.io/docs/Nginx/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Nginx | fn-wang-10.github.io"><meta data-rh="true" name="description" content="nginx 是一款轻量级的 web 服务器/反向代理服务器/电子邮件代理服务器"><meta data-rh="true" property="og:description" content="nginx 是一款轻量级的 web 服务器/反向代理服务器/电子邮件代理服务器"><link data-rh="true" rel="icon" href="/img/logo.ico"><link data-rh="true" rel="canonical" href="https://fn-wang-10.github.io/docs/Nginx/"><link data-rh="true" rel="alternate" href="https://fn-wang-10.github.io/docs/Nginx/" hreflang="en"><link data-rh="true" rel="alternate" href="https://fn-wang-10.github.io/docs/Nginx/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="fn-wang-10.github.io RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="fn-wang-10.github.io Atom Feed"><link rel="stylesheet" href="/assets/css/styles.4daee39b.css">
<script src="/assets/js/runtime~main.1ba5ce3c.js" defer="defer"></script>
<script src="/assets/js/main.e6e7c638.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">fn-wang-10</b></a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Nginx/CDN + Nginx 怎么玩的你知道不">CDN + Nginx 怎么玩的你知道不</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Nginx/">Nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Nginx/Nginx基础">Nginx基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Nginx/Nginx常用配置">Nginx常用配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Nginx/Nginx配置文件解析">Nginx配置文件解析</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Nginx</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Nginx</h1></header><p>nginx 是一款轻量级的 web 服务器/反向代理服务器/电子邮件代理服务器</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置文件的结构">配置文件的结构<a href="#配置文件的结构" class="hash-link" aria-label="Direct link to 配置文件的结构" title="Direct link to 配置文件的结构">​</a></h2>
<p>nginx 由由配置文件中指定的指令控制的模块组成。指令分为简单指令和块指令。简单的指令由名称和参数组成，名称和参数之间用空格分隔，并以分号 ( ;) 结尾。
块指令具有与简单指令相同的结构，但它不是以分号结尾，而是以一组由大括号 (<!-- -->) 包围的附加指令结尾。如果块指令可以在大括号内包含其他指令，则称为上下文（例如： events、 http、 server 和 location）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1正向代理与反向代理">1.正向代理与反向代理<a href="#1正向代理与反向代理" class="hash-link" aria-label="Direct link to 1.正向代理与反向代理" title="Direct link to 1.正向代理与反向代理">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="正向代理">正向代理<a href="#正向代理" class="hash-link" aria-label="Direct link to 正向代理" title="Direct link to 正向代理">​</a></h3>
<p>正向代理（forward）意思是一个位于客户端和原始服务器 (origin server) 之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标 (原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。<br>
<!-- -->正向代理是为我们服务的，即为客户端服务的，客户端可以根据正向代理访问到它本身无法访问到的服务器资源。<br>
<!-- -->正向代理对我们是透明的，对服务端是非透明的，即服务端并不知道自己收到的是来自代理的访问还是来自真实客户端的访问。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="反向代理">反向代理<a href="#反向代理" class="hash-link" aria-label="Direct link to 反向代理" title="Direct link to 反向代理">​</a></h3>
<p>反向代理（Reverse Proxy）方式是指以代理服务器来接受 internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。<br>
<!-- -->反向代理是为服务端服务的，反向代理可以帮助服务器接收来自客户端的请求，帮助服务器做请求转发，负载均衡等。
反向代理对服务端是透明的，对我们是非透明的，即我们并不知道自己访问的是代理服务 器，而服务器知道反向代理在为他服务。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2负载均衡分摊压力">2.负载均衡（分摊压力）<a href="#2负载均衡分摊压力" class="hash-link" aria-label="Direct link to 2.负载均衡（分摊压力）" title="Direct link to 2.负载均衡（分摊压力）">​</a></h2>
<p>一般情况下，客户端发送多个请求到服务器，服务器处理请求，其中一部分可能要操作一些资源比如数据库、静态资源等，服务器处理完毕后，再将结果返回给客户端。<br>
<!-- -->这种模式对于早期的系统来说，功能要求不复杂，且并发请求相对较少的情况下还能胜任，成本也低。随着信息数量不断增长，访问量和数据量飞速增长，以及系统业务复杂度持续增加，这种做法已无法满足要求，并发量特别大时，服务器容易崩。<br>
<!-- -->很明显这是由于服务器性能的瓶颈造成的问题，除了堆机器之外，最重要的做法就是负载均衡。<br>
<!-- -->请求爆发式增长的情况下，单个机器性能再强劲也无法满足要求了，这个时候集群的概念产生了，单个服务器解决不了的问题，可以使用多个服务器，然后将请求分发到各个服务器上，将负载分发到不同的服务器，这就是负载均衡，核心是「分摊压力」。Nginx 实现负载均衡，一般来说指的是将请求转发给服务器集群。</p>
<p>如果请求数过大，单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器的情况改为请求分发到多个服务器上，就是负载均衡。<br>
<!-- -->Nginx 实现负载均衡，一般来说指的是将请求转发给服务器集群。</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream balanceServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.1.22.33:12345;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.1.22.34:12345;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.1.22.35:12345;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  fe.server.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://balanceServer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面的配置只是指定了 nginx 需要转发的服务端列表，并没有指定分配策略。<br>
<!-- -->默认情况下采用的是轮询策略，将所有客户端请求轮询分配给服务端。这种策略是可以正常工作的，但是如果其中某一台服务器压力太大，出现延迟，会影响所有分配在这台服务器下的用户。</p>
<p>Nginx 支持的负载均衡调度算法方式如下：</p>
<p>weight 轮询(默认，常用)：接收到的请求按照权重分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，Nginx 会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。这种方式下，可以给不同的后端服务器设置一个权重值(weight)，用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。</p>
<p>ip_hash（常用）：每个请求按照发起客户端的 ip 的 hash 结果进行匹配，这样的算法下一个固定 ip 地址的客户端总会访问到同一个后端服务器，这也在一定程度上解决了集群部署环境下 session 共享的问题。</p>
<p>fair：智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；结合了前两者的优点的一种调度算法。但是需要注意的是 Nginx 默认不支持 fair 算法，如果要使用这种调度算法，请安装 upstream_fair 模块。</p>
<p>url_hash：按照访问的 url 的 hash 结果分配请求，每个请求的 url 会指向后端固定的某个服务器，可以在 Nginx 作为静态服务器的情况下提高缓存效率。同样要注意 Nginx 默认不支持这种调度算法，要使用的话需要安装 Nginx 的 hash 软件包。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3动静分离">3.动静分离<a href="#3动静分离" class="hash-link" aria-label="Direct link to 3.动静分离" title="Direct link to 3.动静分离">​</a></h2>
<p>为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速度，降低原来单个服务器的压力。<br>
<!-- -->一般来说，都需要将动态资源和静态资源分开，由于 Nginx 的高并发和静态资源缓存等特性，经常将静态资源部署在 Nginx 上。如果请求的是静态资源，直接到静态资源目录获取资源，如果是动态资源的请求，则利用反向代理的原理，把请求转发给对应后台应用去处理，从而实现动静分离。<br>
<!-- -->使用前后端分离后，可以很大程度提升静态资源的访问速度，即使动态服务不可用，静态资源的访问也不会受到影响。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4nginx-常用命令">4.Nginx 常用命令<a href="#4nginx-常用命令" class="hash-link" aria-label="Direct link to 4.Nginx 常用命令" title="Direct link to 4.Nginx 常用命令">​</a></h2>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    nginx -s reload # 向主进程发送信号，重新加载配置文件，热重启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx -s reopen # 重启 Nginx（重新打开日志文件）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx -s stop # 快速关闭（ 快速关闭Nginx，可能不保存相关信息，并迅速终止web服务）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx -s quit # 等待工作进程处理完成后关闭（稳关闭Nginx，保存相关信息，有安排的结束web服务）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx -T # 查看当前 Nginx 最终的配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx -t -c &lt;配置路径&gt; # 检查配置是否有问题，如果已经在配置目录，则不需要-c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">``</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 5.配置文件结构</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx.conf  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main # 全局配置，对全局生效  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── events # 配置影响 Nginx 服务器或与用户的网络连接  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── http # 配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── upstream # 配置后端服务器具体地址，负载均衡配置不可或缺的部分  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── server # 配置虚拟主机的相关参数，一个 http 块中可以有多个 server 块  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── server  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ ├── location # server 块可以包含多个 location 块，location 指令用于匹配 uri  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ ├── location  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ └── ...  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── ...  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">一个 Nginx 配置文件的结构就像 nginx.conf 显示的那样，配置文件的语法规则：  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">配置文件由指令与指令块构成；  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">每条指令以 ; 分号结尾，指令与参数间以空格符号分隔；  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">指令块以 {} 大括号将多条指令组织在一起；  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include 语句允许组合多个配置文件以提升可维护性；  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">使用 # 符号添加注释，提高可读性；  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">使用 $ 符号使用变量；  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">部分指令的参数支持正则表达式；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user nginx; # 运行用户，默认即是nginx，可以不进行设置（设置nginx服务的系统使用用户）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_processes 1; # Nginx 进程数，一般设置为和 CPU 核数一样</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_log /var/log/nginx/error.log warn; # Nginx 的错误日志存放目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid /var/run/nginx.pid; # Nginx 服务启动时的 pid 存放位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use epoll; # 使用epoll的I/O模型(如果你不知道Nginx该使用哪种轮询方法，会自动选择一个最适合你操作系统的)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker_connections 1024; # 每个进程允许最大并发数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">——————————————————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我们使用 nginx 的 http 服务，在配置文件 nginx.conf 中的 http 区域内，配置无数个 server ，每一个 server 对应这一个虚拟主机或者域名。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... ...        #后面再详细介绍 http 配置项目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen 80                          #监听端口;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name localhost              #地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location / {                       #访问首页路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            root /xxx/xxx/index.html       #默认目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            index index.html index.htm     #默认文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error_page  500 504   /50x.html    #当出现以上状态码时从新定义到50x.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location = /50x.html {             #当访问50x.html时</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            root /xxx/xxx/html             #50x.html 页面所在位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ... ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">一个 server 可以出现多个 location ，我们对不同的访问路径进行不同情况的配置。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我们再来看看 http 的配置详情</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendfile  on                  #高效传输文件的模式 一定要开启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keepalive_timeout   65        #客户端服务端请求超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_format  main   XXX        #定义日志格式 代号为main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_log  /usr/local/access.log  main     #日志保存地址 格式代码 main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http { # 配置使用最频繁的部分，代理、缓存、日志定义等绝大多数功能和第三方模块的配置都在这里设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置日志模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_log /var/log/nginx/access.log main; # Nginx访问日志存放位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendfile on; # 开启高效传输模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tcp_nopush on; # 减少网络报文段的数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tcp_nodelay on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keepalive_timeout 65; # 保持连接的时间，也叫超时时间，单位秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types_hash_max_size 2048;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include /etc/nginx/mime.types; # 文件扩展名与类型映射表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default_type application/octet-stream; # 默认文件类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include /etc/nginx/conf.d/*.conf; # 加载子配置项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen 80; # 配置监听的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name localhost; # 配置的域名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root /usr/share/nginx/html; # 网站根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                index index.html index.htm; # 默认首页文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                deny 172.168.22.11; # 禁止访问的ip地址，可以为all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                allow 172.168.33.44； # 允许访问的ip地址，可以为all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error_page 500 502 503 504 /50x.html; # 默认50x对应的访问页面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error_page 400 404 error.html; # 同上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>——————————————————————————————————————————————————————————————————————————<br>
<a href="https://blog.csdn.net/zxd1435513775/article/details/102508463" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zxd1435513775/article/details/102508463</a></p>
<p>Nginx 配置文件<br>
<!-- -->在学习 Nginx 之前，要熟知它的配置文件，毕竟，下面需要做的所有配置（反向代理、负载均衡、动静分离等），都是基于它的配置文件。</p>
<p>Nginx 默认的配置文件是在安装目录下的 conf 目录下，后续对 Nginx 的使用基本上都是对此配置文件进行相应的修改。完整的配置文件，可以看一下文章最后。修改过 nginx.conf 配置文件，记得要重启 Nginx 服务</p>
<p>配置文件中有很多#号，该符号表示注释内容，去掉所有以 #开头的段落，精简之后的配置文件内容如下（PS：其实注释掉的地方，都是一些功能的使用代码，需要用到的时候，取消注释即可）：</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 主进程叫master，负责管理子进程，子进程叫worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># worker_processes配置项表示开启几个业务进程，一般和cpu核数有关</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker_processes  1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker_connections  1024;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # include表示可以引入其他文件，此处表示引入http mime类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include       mime.types;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_type  application/octet-stream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendfile        on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keepalive_timeout  65;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 虚拟主机，可以配置多个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            server_name  localhost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # 路径匹配之后，哪个目录下去匹配相应的网页,html是相对路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location = /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>去掉注释信息后，可以将 nginx.conf 配置文件分为三部分：</p>
<p>2.1 第一部分：全局块</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     worker_processes  1;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从配置文件开始到 events 块之间的内容，主要会设置一些影响 Nginx 服务器整体运行的配置指令，主要包括：配置运行 Nginx 服务器的用户（组）、允许生成的 worker process 数，进程 PID 存放路径、日志存放路径和类型以及配置文件的引入等。</p>
<p>上面这行 worker_processes 配置，是 Nginx 服务器并发处理服务的关键配置，该值越大，可以支持的并发处理量也越多，但是会受到硬件、软件等设备的约束。</p>
<p>2.2 第二部分：events 块</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker_connections  1024;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>events 块涉及的指令主要影响 Nginx 服务器与用户的网络连接，常用的设置包括：是否开启对多 work process 下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型来处理连接请求，每个 work process 可以同时支持的最大连接数等</p>
<p>上述例子就表示每个 work process 支持的最大连接数为 1024。这部分的配置对 Nginx 的性能影响较大，在实际中应该灵活配置。</p>
<p>2.3 第三部分：http 块</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include       mime.types;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_type  application/octet-stream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendfile        on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keepalive_timeout  65;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            server_name  localhost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location = /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这部分是 Nginx 服务器配置中最频繁的部分，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里。需要注意的是：http 块也可以包括 http 全局块、server 块。下面的反向代理、动静分离、负载均衡都是在这部分中配置</p>
<p>http 全局块：http 全局块配置的指令包括：文件引入、MIME-TYPE 定义、日志自定义、连接超时时间、单链接请求数上限等。</p>
<p>server 块：这块和虚拟主机有密切关系，从用户角度看，虚拟主机和一台独立的硬件主机是完全一样的，该技术的产生是为了节省互联网服务器硬件成本。</p>
<p>每个 http 块可以包括多个 server 块，而每个 server 块就相当于一个虚拟主机。而每个 server 块也分为全局 server 块，以及可以同时包含多个 location 块。</p>
<p>2.3.1 全局 server 块<br>
<!-- -->最常见的配置是本虚拟机主机的监听配置和本虚拟主机的名称或 IP 配置。</p>
<p>2.3.2 location 块<br>
<!-- -->一个 server 块可以配置多个 location 块。</p>
<p>这块的主要作用是：基于 Nginx 服务器接收到的请求字符串（例如 server_name/uri-string），对虚拟主机名称（也可以是 IP 别名）之外的字符串（例如 前面的 /uri-string）进行匹配，对特定的请求进行处理。地址定向、数据缓存和应答控制等功能，还有许多第三方模块的配置也在这里进行。</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include       mime.types;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_type  application/octet-stream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendfile        on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keepalive_timeout  65;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            server_name  localhost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 若请求路径像这样：www.xxxx/img/example.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # 则访问/img/目录下的文件时，nginx会去/var/www/image/img/目录下找文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location /img/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root /var/www/image;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location = /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="反向代理如何配置">反向代理如何配置<a href="#反向代理如何配置" class="hash-link" aria-label="Direct link to 反向代理如何配置" title="Direct link to 反向代理如何配置">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="反向代理实例一">反向代理实例一<a href="#反向代理实例一" class="hash-link" aria-label="Direct link to 反向代理实例一" title="Direct link to 反向代理实例一">​</a></h3>
<p>实现效果：使用 Nginx 反向代理，访问www.123.com直接跳转到127.0.0.1:8080<br>
<!-- -->注意：此处如果要想从www.123.com跳转到本机指定的ip，需要修改本机的hosts文件。此处略过<br>
<!-- -->配置代码</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name  192.168.17.129;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_pass  http://127.0.0.1:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如上配置，Nginx 监听 80 端口，访问域名为www.123.com（不加端口号时默认为 80 端口），故访问该域名时会跳转到 127.0.0.1:8080 路径上。<br>
<!-- -->此处的意思为：nginx 反向代理服务监听 192.168.17.129 的 80 端口，如果有请求过来，则转到 proxy_pass 配置的对应服务器上，仅此而已。<br>
<!-- -->在 location 下，同时配置 root 和 proxy_pass 选项时，两个选项只会二选一执行<br>
<!-- -->此处不能配置 https 反向代理</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="反向代理实例二">反向代理实例二<a href="#反向代理实例二" class="hash-link" aria-label="Direct link to 反向代理实例二" title="Direct link to 反向代理实例二">​</a></h3>
<p>实现效果：使用 Nginx 反向代理，根据访问的路径跳转到不同端口的服务中，Nginx 监听端口为 9001<br>
<!-- -->访问<a href="http://192.168.17.129/edu/%E7%9B%B4%E6%8E%A5%E8%B7%B3%E8%BD%AC%E5%88%B0" target="_blank" rel="noopener noreferrer">http://192.168.17.129/edu/直接跳转到</a> 127.0.0.1:8080<br>
<!-- -->访问<a href="http://192.168.17.129/vod/%E7%9B%B4%E6%8E%A5%E8%B7%B3%E8%BD%AC%E5%88%B0" target="_blank" rel="noopener noreferrer">http://192.168.17.129/vod/直接跳转到</a> 127.0.0.1:8081<br>
<!-- -->第一步，需要准备两个 tomcat，一个 8080 端口，一个 8081 端口，并准备好测试的页面<br>
<!-- -->第二步，修改 nginx 的配置文件，在 http 块中配置 server</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen       9001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name  192.168.17.129;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ /edu/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_pass  http://127.0.0.1:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location ~ /vod/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_pass  http://127.0.0.1:8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>根据上面的配置，当请求到达 Nginx 反向代理服务器时，会根据请求路径不同进行分发到不同的服务上。</p>
<p>补充：location 指令说明<br>
<!-- -->该指令用于匹配 URL， 语法如下：</p>
<div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    location [ = | ~ | ~* | ^~] uri {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>= ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求<br>
<!-- -->~：用于表示 uri 包含正则表达式，并且区分大小写<br>
<del>_：用于表示 uri 包含正则表达式，并且不区分大小写<br>
<!-- -->^</del>：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求。字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location 块中的正则 uri 和请求字符串做匹配。<br>
<!-- -->注意：如果 uri 包含正则表达式，则必须要有 ~ 或者 ~_ 标识、</p>
<p>————————————————————————————————————————————————————————————————————<br>
<a href="https://www.cnblogs.com/wx170119/p/11349475.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/wx170119/p/11349475.html</a><br>
<!-- -->nginx 反向代理原理及配置详解</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Nginx/CDN + Nginx 怎么玩的你知道不"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CDN + Nginx 怎么玩的你知道不</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Nginx/Nginx基础"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Nginx基础</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#配置文件的结构" class="table-of-contents__link toc-highlight">配置文件的结构</a></li><li><a href="#1正向代理与反向代理" class="table-of-contents__link toc-highlight">1.正向代理与反向代理</a><ul><li><a href="#正向代理" class="table-of-contents__link toc-highlight">正向代理</a></li><li><a href="#反向代理" class="table-of-contents__link toc-highlight">反向代理</a></li></ul></li><li><a href="#2负载均衡分摊压力" class="table-of-contents__link toc-highlight">2.负载均衡（分摊压力）</a></li><li><a href="#3动静分离" class="table-of-contents__link toc-highlight">3.动静分离</a></li><li><a href="#4nginx-常用命令" class="table-of-contents__link toc-highlight">4.Nginx 常用命令</a></li><li><a href="#反向代理如何配置" class="table-of-contents__link toc-highlight">反向代理如何配置</a><ul><li><a href="#反向代理实例一" class="table-of-contents__link toc-highlight">反向代理实例一</a></li><li><a href="#反向代理实例二" class="table-of-contents__link toc-highlight">反向代理实例二</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>