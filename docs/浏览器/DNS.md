## 一、是什么

DNS（Domain Names System），域名系统，是互联网一项服务，是进行域名和与之相对应的 IP 地址进行转换的服务器  
简单来讲，DNS 相当于一个翻译官，负责将域名翻译成 ip 地址  
IP 地址：一长串能够唯一地标记网络上的计算机的数字  
域名：是由一串用点分隔的名字组成的 Internet 上某一台计算机或计算机组的名称，用于在数据传输时对计算机的定位标识

## 二、域名

域名是一个具有层次的结构，从上到下一次为根域名、顶级域名、二级域名、三级域名...  
例如www.xxx.com  
www为三级域名  
xxx为二级域名  
com为顶级域名  
系统为用户做了兼容，域名末尾的根域名.一般不需要输入

## 三、查询方式

DNS 查询的方式有两种：  
递归查询：如果 A 请求 B，那么 B 作为请求的接收者一定要给 A 想要的答案  
迭代查询：如果接收者 B 没有请求者 A 所需要的准确内容，接收者 B 将告诉请求者 A，如何去获得这个内容，但是自己并不去发出请求

## 四、域名缓存

在域名服务器解析的时候，使用缓存保存域名和 IP 地址的映射  
计算机中 DNS 的记录也分成了两种缓存方式：  
浏览器缓存：浏览器在获取网站域名的实际 IP 地址后会对其进行缓存，减少网络请求的损耗  
操作系统缓存：操作系统的缓存其实是用户自己配置的 hosts 文件

## 五、查询过程

解析域名的过程如下：

1. 首先搜索浏览器的 DNS 缓存，缓存中维护一张域名与 IP 地址的对应表
2. 搜索操作系统的 DNS 缓存（本地 host 文件）
3. 操作系统将域名发送至本地域名服务器(网络运营商 ISP)，本地域名服务器采用递归查询自己的 DNS 缓存，  
   若本地域名服务器的 DNS 缓存没有命中，则本地域名服务器向上级域名服务器进行迭代查询  
    首先本地域名服务器向根域名服务器发起请求，根域名服务器返回顶级域名服务器的地址给本地服务器  
    本地域名服务器拿到这个顶级域名服务器的地址后，就向其发起请求，获取权限域名服务器的地址  
    本地域名服务器根据权限域名服务器的地址向其发起请求，最终得到该域名对应的 IP 地址  
   本地域名服务器将得到的 IP 地址返回给操作系统，同时自己将 IP 地址缓存起来
   操作系统将 IP 地址返回给浏览器，同时自己也将 IP 地址缓存起  
   至此，浏览器就得到了域名对应的 IP 地址，并将 IP 地址缓存起

其完整的 DNS 解析过程有以下几个步骤：

1. 查看浏览器缓存  
   当用户通过浏览器访问某域名时，浏览器首先会在自己的缓存中查找是否有该域名对应的 IP 地址（若曾经访问过该域名且没有清空缓存便存在）。
2. 查看系统缓存  
   当浏览器缓存中无域名对应 IP 则会自动检查用户计算机系统 Hosts 文件 DNS 缓存是否有该域名对应 IP。
3. 查看路由器缓存  
   当浏览器及系统缓存中均无域名对应 IP 则进入路由器缓存中检查，以上三步均为客服端的 DNS 缓存。
4. 查看 ISP DNS 缓存  
   当在用户客服端查找不到域名对应 IP 地址，则将进入 ISP DNS 缓存中进行查询。比如你用的是电信的网络，则会进入电信的 DNS 缓存服务器中进行查找。
5. 询问根域名服务器  
   当以上均未完成，则进入根服务器进行查询。全球仅有 13 台根域名服务器，1 个主根域名服务器，其余 12 为辅根域名服务器。根域名收到请求后会查看区域文件记录，若无则将其管辖范围内顶级域名（如.com、.cn 等）服务器 IP 告诉本地 DNS 服务器。
6. 询问顶级域名服务器  
   顶级域名服务器收到请求后查看区域文件记录，若无记录则将其管辖范围内权威域名服务器的 IP 地址告诉本地 DNS 服务器。
7. 询问权威域名（主域名）服务器  
   权威域名服务器接受到请求后查询自己的缓存，如果没有则进入下一级域名服务器进行查找，并重复该步骤直至找到正确记录。
8. 保存结果至缓存  
   本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端，客户端通过这个 IP 地址即可访问目标 Web 服务器。至此，DNS 递归查询的整个过程结束。

浏览器的 DNS 缓存————操作系统的 DNS 缓存（用户节点的本地 host 文件）————路由器缓存————本地域名服务器（网络运营商 ISP 递归查询）————根域名服务器（返回顶级域名服务器地址给本地）————顶级域名服务器（返回权限域名服务器给本地）————权限域名服务器，获取对应的 IP 地址————本地域名服务器进行缓存（网络运营商）————操作系统缓存————浏览器缓存，浏览器拿到 IP 地址，向对应的服务器发送请求
